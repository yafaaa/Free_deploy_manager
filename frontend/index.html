<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Recommendations</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div id="app">
        <h1>Project Recommendations</h1>

        <section id="project-form">
            <h2>Submit Your Project</h2>
            <form id="projectForm">

                <label for="backend_language">Backend Language:</label>
                <select id="backend_language" name="backend_language" required>
                    <option value="Python">Python</option>
                    <option value="JavaScript">JavaScript</option>
                    <option value="Java">Java</option>
                    <option value="TypeScript">TypeScript</option>
                    <option value="Go">Go (or Golang)</option>
                    <option value="C#">C#</option>
                    <option value="Rust">Rust</option>
                    <option value="PHP">PHP</option>
                    <option value="Ruby">Ruby</option>
                    <option value="Kotlin">Kotlin</option>
                    <option value="Swift">Swift</option>
                    <option value="C++">C++</option>
                    <option value="Dart">Dart</option>
                    <option value="Scala">Scala</option>
                    <option value="Elixir">Elixir</option>
                </select>

                <label for="database_type">Database Type:</label>
                <select id="database_type" name="database_type" required>
                    <option value="PostgreSQL">PostgreSQL</option>
                    <option value="MySQL">MySQL</option>
                    <option value="Microsoft SQL Server">Microsoft SQL Server</option>
                    <option value="Oracle Database">Oracle Database</option>
                    <option value="SQLite">SQLite</option>
                    <option value="MongoDB">MongoDB</option>
                    <option value="Redis">Redis</option>
                    <option value="Elasticsearch">Elasticsearch</option>
                    <option value="Apache Cassandra">Apache Cassandra</option>
                    <option value="Amazon DynamoDB">Amazon DynamoDB</option>
                </select>

                <label for="expected_traffic">Expected Traffic:</label>
                <select id="expected_traffic" name="expected_traffic" required>
                    <option value="tiny">&lt; 50k req/mo (Tiny)</option>
                    <option value="hobby">50k–500k req/mo (Hobby)</option>
                    <option value="busy">0.5–2M req/mo (Busy)</option>
                </select>

                <label for="data_size">Data Size:</label>
                <select id="data_size" name="data_size" required>
                    <option value="small">&lt; 0.5 GB (Small)</option>
                    <option value="medium">0.5–2 GB (Medium)</option>
                    <option value="large">2–10 GB (Large)</option>
                </select>

                <button type="submit">Submit</button>
            </form>
        </section>

        <section id="recommendations">
            <h2>Recommendations</h2>
            <ul id="recommendationList"></ul>
            <h3>Debug: Received Payload</h3>
            <pre id="debugReceived" style="background:#f0f0f0;padding:10px;border:1px solid #ccc;"></pre>
        </section>
    </div>

    <!-- Single inline script for form submission and debug -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const form = document.getElementById('projectForm');
        if (!form) return console.error('Form not found');
        form.addEventListener('submit', async function(e) {
          e.preventDefault();
          const payload = {
            lang: document.getElementById('backend_language').value,
            db: document.getElementById('database_type').value,
            expected_traffic: document.getElementById('expected_traffic').value,
            data_size: document.getElementById('data_size').value
          };
          console.log('Sending payload:', payload);
          try {
            const response = await fetch('/api/projects/recommend/', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(payload)
            });
            console.log('Fetch status:', response.status);
            const data = await response.json();
            console.log('Received:', data);
            const recList = document.getElementById('recommendationList'); recList.innerHTML = '';
            if (!data.recommendations || data.recommendations.length === 0) {
              recList.innerHTML = '<li>No recommendations found.</li>';
            } else {
              data.recommendations.forEach(r => {
                const li = document.createElement('li');
                li.textContent = `${r.name}: ${r.description}`;
                recList.appendChild(li);
              });
            }
            const debugElem = document.getElementById('debugReceived');
            if (debugElem) debugElem.textContent = JSON.stringify(data.received || {}, null, 2);
          } catch(err) {
            console.error('Error submitting form:', err);
          }
        });
      });
    </script>
  </body>
</html>
